<div class="box">
  <div class="chatbox">
    <div class="left" *ngIf="users && loading == false">
      <h4>Hello {{ username }}</h4>
      <h6>
        <span *ngIf="onlineUsers">{{ onlineUsers.length - 1 || "0" }}</span>
        users online
      </h6>
      <div class="allUsers">
        <div
          class="users"
          *ngFor="let el of users"
          [routerLink]="['user', el.id]"
        >
          <ng-container *ngIf="token !== el.id">
            <mdb-icon class="icon" fas icon="user-circle"></mdb-icon>
            <div class="status">
              <span>{{ el.username }}</span>
              <span
                *ngIf="onlineCheck(el)"
                (click)="switchStatus(el)"
                class="stat"
              >
                <span class="circle"></span>Online</span
              >
              <span *ngIf="!onlineCheck(el)" class="stat">
                <span class="red"></span>Offline</span
              >
            </div>
          </ng-container>
        </div>
      </div>
      <hr />
      <h3>
        Rooms<mdb-icon
          *ngIf="object.role == 'Admin'"
          (click)="showModal()"
          class="add"
          fas
          icon="plus-circle"
        ></mdb-icon>
      </h3>
      <div class="rooms">
        <div class="room" *ngFor="let el of rooms" (click)="joinRoom(el)">
          <mdb-icon class="icon" fas icon="comment"></mdb-icon>
          <div class="status">
            <span> {{ el.roomName }} </span>
            <span class="stat">{{ el.roomUsers.length }} users</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Skeleton -->
    <div class="left" *ngIf="loading != false">
      <h4>Hello Strangers</h4>
      <h6>?? users online</h6>
      <div class="allUsers">
        <div class="users">
          <ngx-skeleton-loader
            style="transform: scale(1.3)"
            count="1"
            appearance="circle"
            animation="pulse"
            [theme]="{
              transform: 'scale(1.1)'
            }"
          ></ngx-skeleton-loader>
          <div style="width: 90px">
            <span>
              <ngx-skeleton-loader animation="pulse"></ngx-skeleton-loader>
            </span>
          </div>
        </div>
        <div class="users">
          <ngx-skeleton-loader
            style="transform: scale(1.3)"
            count="1"
            appearance="circle"
            animation="pulse"
            [theme]="{
              transform: 'scale(1.1)'
            }"
          ></ngx-skeleton-loader>
          <div style="width: 90px">
            <span>
              <ngx-skeleton-loader animation="pulse"></ngx-skeleton-loader>
            </span>
          </div>
        </div>
        <div class="users">
          <ngx-skeleton-loader
            style="transform: scale(1.3)"
            count="1"
            appearance="circle"
            animation="pulse"
            [theme]="{
              transform: 'scale(1.1)'
            }"
          ></ngx-skeleton-loader>
          <div style="width: 90px">
            <span>
              <ngx-skeleton-loader animation="pulse"></ngx-skeleton-loader>
            </span>
          </div>
        </div>
        <div class="users">
          <ngx-skeleton-loader
            style="transform: scale(1.3)"
            count="1"
            appearance="circle"
            animation="pulse"
            [theme]="{
              transform: 'scale(1.1)'
            }"
          ></ngx-skeleton-loader>
          <div style="width: 90px">
            <span>
              <ngx-skeleton-loader animation="pulse"></ngx-skeleton-loader>
            </span>
          </div>
        </div>
        <div class="users">
          <ngx-skeleton-loader
            style="transform: scale(1.3)"
            count="1"
            appearance="circle"
            animation="pulse"
            [theme]="{
              transform: 'scale(1.1)'
            }"
          ></ngx-skeleton-loader>
          <div style="width: 90px">
            <span>
              <ngx-skeleton-loader animation="pulse"></ngx-skeleton-loader>
            </span>
          </div>
        </div>
      </div>
    </div>
    <!-- End Skeleton -->

    <div *ngIf="loading == false && msgInboxArray" class="right">
      <h4>Public Room</h4>
      <p>{{ msgInboxArray.length }} messages</p>
      <hr />
      <div #container class="messages">
        <div
          [ngClass]="username == mObj.senderName ? 'leftone' : 'rightone'"
          class="singleMessage"
          *ngFor="let mObj of msgInboxArray"
        >
          <h6>
            <!-- {{ mObj.user }} -->
            {{ mObj.senderName }}
            <!-- <span style="color: grey">{{ mObj.dateCreated | date: "dd MMMM yyyy, HH:mm:ss" }} </span> -->
            <span style="color: grey"
              >{{ mObj.sentDate | date: "dd MMMM yyyy, HH:mm:ss" }}
            </span>
            <mdb-icon fas icon="angle-down"></mdb-icon>
          </h6>
          <p [ngStyle]="myStyles(mObj)">
            <!-- {{ mObj.message }} -->
            {{ mObj.content }}
          </p>
        </div>
      </div>
      <div style="text-align: center">
        <mdb-icon
          style="cursor: pointer; font-size: 25px; width: 50px"
          class="lmao"
          (click)="scrollDown()"
          fas
          icon="angle-double-down"
        ></mdb-icon>
      </div>
      <hr />
      <form
        [formGroup]="textbox"
        (ngSubmit)="send(textbox.value.message)"
        class="form"
      >
        <textarea
          #message
          id="textarea1"
          style="resize: none"
          type="text"
          placeholder="Write your message"
          formControlName="message"
          (keydown)="triggerFunction($event, textbox.value.message)"
        ></textarea>
        <button [disabled]="textbox.invalid" type="submit">
          <mdb-icon fas icon="paper-plane"></mdb-icon>
        </button>
      </form>
    </div>

    <!-- Skeleton -->
    <div *ngIf="loading != false" class="right">
      <h4>Public Room</h4>
      <p>?? messages</p>
      <hr />
      <div #container class="messages">
        <div class="rightone" class="singleMessage">
          <span>
            <ngx-skeleton-loader
              count="5"
              animation="progress"
              [theme]="{
                height: '150px',
                'background-color': 'grey',
                border: '1px solid white'
              }"
            ></ngx-skeleton-loader>
          </span>
        </div>
      </div>
      <div style="text-align: center">
        <mdb-icon
          style="cursor: pointer; font-size: 25px; width: 50px"
          class="lmao"
          (click)="scrollDown()"
          fas
          icon="angle-double-down"
        ></mdb-icon>
      </div>
      <hr />
      <form [formGroup]="textbox" (ngSubmit)="console.log('lmao')" class="form">
        <textarea
          #message
          id="textarea1"
          style="resize: none"
          type="text"
          placeholder="Wait Please"
          formControlName="message"
        ></textarea>
        <button [disabled]="true" type="submit">
          <mdb-icon fas icon="paper-plane"></mdb-icon>
        </button>
      </form>
    </div>
    <!-- End Skeleton -->
  </div>
</div>

<!-- Modal Content -->
<form
  *ngIf="addRoom"
  [formGroup]="addRoom"
  (ngSubmit)="add(addRoom.value)"
  class="addRoom"
  [ngClass]="{ show: isShown }"
>
  <div class="addRoom-content">
    <h2>Add Room</h2>
    <div class="md-form">
      <input
        type="email"
        id="Room"
        class="form-control"
        mdbInput
        formControlName="roomName"
        style="color: white"
      />
      <label for="Room">Room</label>
    </div>
    <em
      style="margin: 20px 100px"
      *ngIf="
        addRoom.get('roomName').hasError('required') &&
        addRoom.get('roomName').touched
      "
      >Required</em
    >
    <em
      style="margin: 20px 100px"
      *ngIf="
        addRoom.get('roomName').hasError('maxlength') &&
        addRoom.get('roomName').touched
      "
      >Too Long !
    </em>
    <em style="margin: 20px 100px" *ngIf="error">
      {{error}}
    </em>
    <button
      [disabled]="addRoom.invalid"
      [ngClass]="{ invalid: addRoom.invalid }"
      type="submit"
      class="animated"
    >
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      Add
    </button>
    <button (click)="closeModal()" type="submit" class="animated">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
      Close
    </button>
  </div>
</form>
